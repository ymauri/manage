<div class="form-body">
    <fieldset id="data-checkout" class="col-md-12">
            <div class="form-body">
            <div id="section-checkout" class="col-md-7 col-md-offset-2" style= "margin-bottom: 10px">
                {% set control_chekout = 1 %}
                {% if rcheckout|length > 0 %}
                    {% for var in rcheckout%}
                        <form id="form-checkout-{{ control_chekout }}" class="container-fluid form-horizontal edit  ">
                            <input hidden="hidden" name="id" id="id" value="{{ var.id }}">

                            <table class="table table-responsive table-condensed" style="border: none">
                                <tbody>
                                <tr>
                                    <td>{% if var.fromguesty %}<img src="{{ asset('img/guesty_out.png') }}"  style="max-width: 30px; min-width: 30px;"/> {% endif %}</td>
                                    <td><!--<img class="cleanning confirm-checkout-{{control_chekout}}" src="{{ asset('img/readytoclear.png') }}" class="col-md-1" style="max-width: 30px; min-width: 30px; display: none"/>--></td>

                                    <td><input type="checkbox" style="height: 30px; width: 20%; margin-right: 10px;" id="confirm-checkout-{{control_chekout}}" name="confirm-checkout-{{control_chekout}}" {% if var.checkoutdone %}checked="checked" {% endif %}><b style="top: -10px; position: relative;">Uitcheck <span class="serial_checkout"></span></b></td>

                                    <td>

                                        <select id="checkout-listing-{{control_chekout}}" class="form-control input-sm listing-checkout control-{{control_chekout}}" data-placeholder="Select..." name='listing-{{control_chekout}}' onchange="addCheckout($(this))">
                                            <option></option>

                                            {% for val in listing%}
                                                <option value="{{val.id}}" {% if var.listing.id == val.id %} selected = "selected"{% endif %}>{{val.details}}</option>
                                            {% endfor  %}
                                        </select>
                                    </td>
                                    <td style="border-top: none;">
                                        {% if help.checkout_listing.content %}<i class="fa fa-question-circle tooltips" style="color: #d4d4d4;" data-placement="right" data-original-title="{{ help.checkout_listing.content }}"></i>{% endif %}
                                    </td>

                                </tr>
                                <tr>

                                    <td style="border-top: none;  text-align: right;" colspan="3">Naam</td>
                                    <td style="border-top: none;"><input class="col-md-12 input-sm"  placeholder="" disabled="disabled" value="{% if  var.checkout %}{{ var.checkout.name }}{% endif %}"/></td>
                                    <td style="border-top: none;" >
                                        {% if help.checkout_name.content %}<i class="fa fa-question-circle tooltips" style="color: #d4d4d4;" data-placement="right" data-original-title="{{ help.checkout_name.content }}"></i>{% endif %}
                                    </td>
                                </tr>
                                <tr>

                                    <td style="border-top: none;  text-align: right;" colspan="3">Aantal Nachten</td>
                                    <td style="border-top: none;"><input class="col-md-3 input-sm"  placeholder="" disabled="disabled" value="{% if  var.checkout %}{{ var.checkout.nights }}{% endif %}"/></td>
                                    <td style="border-top: none;" >
                                        {% if help.checkout_nights.content %}<i class="fa fa-question-circle tooltips" style="color: #d4d4d4;" data-placement="right" data-original-title="{{ help.checkout_nights.content }}"></i>{% endif %}
                                    </td>
                                </tr>
                                <tr hidden="hidden">
                                    <td style="border-top: none;  text-align: right;" colspan="3">Borg Ontvangen €</td>
                                    <td style="border-top: none;"><input class="col-md-3 input-sm real" name=""  placeholder="" disabled="disabled" id="checkin-borg-{{ control_chekout }}" style="text-align: right;" /></td>
                                    
                                </tr>
                                <tr hidden="hidden">
                                    <td style="border-top: none; text-align: right;" colspan="3";  >Borg retour €</td>
                                    <td style="border-top: none;"><input class="col-md-3 input-sm real retour" name="borg-{{ control_chekout }}" placeholder="" style="text-align: right;" value="{{ var.borg | number_format (2, ',', '.') }}"/></td>
                                </tr>
                                <tr>
                                    <td style="border-top: none; text-align: right;" colspan="3">Opmerkingen</td>
                                    <td style="border-top: none;"><textarea class="col-md-12" name="details-{{ control_chekout }}" class="form-control input-sm" placeholder="">{{ var.details }}</textarea></td>
                                    <td style="border-top: none;" >
                                        {% if help.checkout_details.content %}<i class="fa fa-question-circle tooltips" style="color: #d4d4d4;" data-placement="right" data-original-title="{{ help.checkout_details.content }}"></i>{% endif %}
                                    </td>
                                </tr>
                            </tbody>
                            </table>


                            <input hidden="hidden" name="fromguesty" id="fromguesty" value="{{ var.fromguesty }}">
                            <input hidden="hidden" name="checkoutid" id="checkoutid" {% if var.checkout %}value="{{ var.checkout.id }}"{% endif %}>
                            <input hidden="hidden" name="name" id="name" value="{{ var.name }}">

                            <script>
                                /*$.post("{{ path('hotel_last_checkin')}}", {'apto':{{ var.listing.id }}, 'hotel_id': '{{ entity_basic.id }}'  }, function(response){
                                    if (!isNaN(response)) {
                                        $('#checkin-borg-'+{{control_chekout}}).val(numeral(response).format('0.0,'))
                                    }
                                    else $('#checkin-borg-'+{{control_chekout}}).val('')
                                })*/
                            </script>

                        </form>

                        {% set control_chekout = control_chekout + 1 %}
                    {% endfor %}  
                {% endif %}
                {% if not show %}
                <form id="form-checkout-{{ control_chekout }}" class="container-fluid form-horizontal edit  ">
                    <table class="table table-responsive table-condensed" style="border: none">
                                <tbody>
                                <tr>
                                    <td></td>
                                    <td><img class="cleanning confirm-checkout-{{control_chekout}}" src="{{ asset('img/readytoclear.png') }}" class="col-md-1" style="max-width: 30px; min-width: 30px; display: none"/></td>

                                    <td><input type="checkbox" style="height: 30px; width: 18%; margin-right: 10px;" id="confirm-checkout-{{control_chekout}}" name="confirm-checkout-{{control_chekout}}" ><b style="top: -10px; position: relative;">Uitcheck <span class="serial_checkout"></span></b></td>


                                    <td>
                                        <select id="checkout-listing-{{control_chekout}}" class="form-control input-sm listing-checkout control-{{control_chekout}} last-checkout" data-placeholder="Select..." name='listing-{{control_chekout}}' onchange="addCheckout($(this))">
                                            <option></option>
                                            {% for val in listing%}
                                                <option value="{{val.id}}" >{{val.details}}</option>
                                            {% endfor  %}
                                        </select>
                                    </td>
                                    <td style="border-top: none;" >
                                        {% if help.checkout_listing.content %}<i class="fa fa-question-circle tooltips" style="color: #d4d4d4;" data-placement="right" data-original-title="{{ help.checkout_listing.content }}"></i>{% endif %}
                                    </td>
                                </tr>

                                <tr hidden="hidden">
                                    <td style="border-top: none;"></td>
                                    <td style="border-top: none;">Borg Ontvangen €</td>
                                    <td style="border-top: none;"><input class="col-md-3  input-sm real" name="" placeholder="" disabled="disabled" id="checkin-borg-{{ control_chekout }}" style="text-align: right;"/></td>
                                    <td style="border-top: none;"></td>
                                </tr>
                                <tr hidden="hidden">
                                    <td style="border-top: none;"></td>
                                    <td style="border-top: none;">Borg retour €</td>
                                    <td style="border-top: none;"><input class="col-md-3 retour input-sm real" name="borg-{{ control_chekout }}" placeholder="" style="text-align: right;"/></td>
                                    <td style="border-top: none;"></td>
                                </tr>
                                <tr >

                                    <td style="border-top: none; text-align: right" colspan="3">Opmerkingen</td>
                                    <td style="border-top: none;"><textarea class="col-md-12" name="details-{{ control_chekout }}" class="form-control input-sm" placeholder=""></textarea></td>
                                    <td style="border-top: none;" >
                                        {% if help.checkout_details.content %}<i class="fa fa-question-circle tooltips" style="color: #d4d4d4;" data-placement="right" data-original-title="{{ help.checkout_details.content }}"></i>{% endif %}
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                          
                        </form>
                {% set control_chekout = control_chekout + 1 %}
                {% endif %}
            </div>
            </div>
    </fieldset>
</div>
<script>
    updateSerialCheckout()
    findListingSelectedCheckout()
    $('input.real').trigger('blur')
    var serialcheckout = {{ control_chekout }};
    
    
    function updateSerialCheckout(){
        $('.serial_checkout').each(function(index, item){
            $(item).text(index + 1)
        })
    }
     function source_opciones(){
        value = ''
        {% for item in sources%}
            value = value + '<option name="{% if (item.extrafield == 1) %}1 {% else  %}  0 {% endif %}" value="{{item.id}}">{{item.details}}</option>'
        {% endfor %}
        return value;
    }
    
    function listing_opciones(){
        value = ''
        {% for item in listing%}
            value = value + '<option value="{{item.id}}">{{item.details}}</option>'
        {% endfor %}
        return value;
    }
    
    function findListingSelectedCheckout(){
        $('.listing-checkout option').removeAttr('style','')
        //$('.listing-checkout option').is(':selected')
        $('.listing-checkout').each(function(index,item){
            seleccionado = $(item).val()
            $('.listing-checkout option').each(function(index1,item1){
               if($(item1).val() == seleccionado){
                   $(item1).attr('style','color:red;')
               }
            })
        })
    }
    
   $('input[type="checkbox"]').bind('click')
   
   function addCheckout(current){
        current_value = current.val()
        if (current_value == '' || current_value == null){
           current.parent().parent().parent().parent().parent().remove();
            completeProfit()
        }
        else {
            if (current.hasClass('last-checkout')){
                $('.last-checkout').removeClass('last-checkout')
                table = $('<table class="table table-responsive table-condensed" style="border: none"></table>')
                tbody = $('<tbody></tbody>')
                first_row = $('<tr> <td><img class="cleanning confirm-checkout-'+serialcheckout+'" src="{{ asset('img/readytoclear.png') }}" class="col-md-1" style="max-width: 30px; min-width: 30px; display: none"/></td> <td><input type="checkbox" style="height: 30px; width: 20%; margin-right: 10px;"  id="confirm-checkout-'+ serialcheckout +'" name="confirm-checkout-'+ serialcheckout +'" onclick="statusClear($(this))"><b style="top: -10px; position: relative;">Uitcheck <span class="serial_checkout"></span></b></td><td><select id="checkout-listing-'+ serialcheckout +'" class="form-control input-sm listing-checkout last-checkout control-'+ serialcheckout +'" data-placeholder="Select..." name="listing-'+ serialcheckout +'" onchange="addCheckout($(this))"><option></option> ' + listing_opciones() + ' </select></td><td style="border-top: none;" >\n\
                        {% if help.checkout_listing.content %}<i class="fa fa-question-circle tooltips" style="color: #d4d4d4;" data-placement="right" data-original-title="{{ help.checkout_listing.content }}"></i>{% endif %}</td></tr>')
                tbody.append(first_row)
                third_row = $('')
                tbody.append(third_row)
                //third_row = $('<tr><td style="border-top: none;"></td><td style="border-top: none;">Borg Ontvangen €</td><td style="border-top: none;"><input class="col-md-3 input-sm real" name="" placeholder="" disabled="disabled" id="checkin-borg-'+serialcheckout+'" style="text-align: right;"/></td><td style="border-top: none;"></td></tr>')
                //tbody.append(third_row)
                //fourth_row = $('<tr><td style="border-top: none;"></td><td style="border-top: none;">Borg retour €</td><td style="border-top: none;"><input class="col-md-3 input-sm real retour" name="borg-'+serialcheckout+'" placeholder="" style="text-align: right;"/></td><td style="border-top: none;"></td></tr>')
                //tbody.append(fourth_row)
                second_row = $('<tr> <td style="border-top: none; text-align: right" colspan="2">Opmerkingen</td> <td style="border-top: none;"><textarea class="col-md-12" name="details-'+ serialcheckout +'" class="form-control input-sm" placeholder=""></textarea></td> <td style="border-top: none;" >\n\
                        {% if help.checkout_details.content %}<i class="fa fa-question-circle tooltips" style="color: #d4d4d4;" data-placement="right" data-original-title="{{ help.checkout_details.content }}"></i>{% endif %}</td></tr>')
                tbody.append(second_row)
                table.append(tbody)
                form = $('<form id="form-checkout-'+serialcheckout+'" class="container-fluid form-horizontal edit"></form>')
                form.append(table)
                $('#section-checkout').append(form);
                 $('#checkout-listing-'+ serialcheckout).bind('change')
                $('.tooltips').tooltip()
                 serialcheckout = serialcheckout + 1

            }
            $.post("{{ path('hotel_last_checkin')}}", {'apto':current_value, 'hotel_id': '{{ entity_basic.id }}'  }, function(response){
                separate = current.attr('id')
                id = separate.split('-')
                if (!isNaN(response)) {
                    $('#checkin-borg-'+id[2]).val(numeral(response).format('0.0,'))
                }
                else $('#checkin-borg-'+id[2]).val('')
            })

        }
        updateSerialCheckout()
        findListingSelectedCheckout()

       Layout.init();
   }

    $('.retuor').on({
        'keyup':function(){
            completeProfit()
        }
    })

    /*$('#section-checkout').on('click','input[type="checkbox"]', function(){

        statusClear($(this));

    })

    function statusClear(control){
        if (control.is(":checked")){
            $('.cleanning.'+control.attr('id')).attr('src',"{{ asset('img/readytoclear.png') }}").show();
        }
        else{
            $('.cleanning.'+control.attr('id')).hide();
        }
    }

    $('#section-checkout input[type="checkbox"]').each(function(){
        statusClear($(this));
    })*/




    </script>
