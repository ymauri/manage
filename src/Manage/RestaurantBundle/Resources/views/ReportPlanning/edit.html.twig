{% extends 'AdminBundle::frame.html.twig' %}
{% block title %} Edit Issue {% endblock %}
{% block body %}
    <div class="portlet">
        <div class="portlet-title">
            <div class="caption">
                <i class="icon-energy"></i>Edit Issue
            </div>
            <div class="tools">
                <a href="{{ path('reportissue_index') }}" class=" blue">
                    <i class="fa fa-list-alt"></i> List
                </a>
            </div>
        </div>
        <div class="portlet box blue-hoki">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-pencil"></i>Edit
                </div>
                <div class="tools">
                    <a href="javascript:;" class="collapse">
                    </a>
                </div>
            </div>
            <div class="portlet-body form">
                {% if form_errors(edit_form) %}
                    <div class="form-errors alert alert-danger">
                        {{ form_errors(edit_form) }}
                    </div>
                {% endif %}
                <form class="container-fluid form-horizontal" action="{{ path('reportissue_edit', {"id":reportIssue.id}) }}"
                      method="POST" {{ form_enctype(edit_form) }} novalidate>
                    <div class="form-body">

                        <div class="col-md-5">
                            <div class="row form-group">
                                {{ form_label(edit_form.dated,'Date',{'attr':{
                                    'class' :' control-label',
                                }}) }}
                                {{ form_widget(edit_form.dated, {'attr':{
                                    'class' :'input-sm pull-right form-control',
                                    'value' : 'now' | date('Y-m-d')
                                }}) }}
                                {{ form_errors(edit_form.dated) }}
                            </div>
                            <div class="row form-group">
                                {{ form_label(edit_form.reportedat,'Time',{'attr':{
                                    'class' :' control-label',
                                }}) }}
                                {{ form_widget(edit_form.reportedat, {'attr':{
                                    'class' :'input-sm pull-right form-control',
                                    'value' : 'now' | date('H:i'),
                                    'readonly' : 'readonly'
                                }}) }}
                                {{ form_errors(edit_form.reportedat) }}
                            </div>
                            <div class="row form-group">
                                <label for="location">Select a Location</label>
                                <select id="location" class="form-control input-sm select2">
                                    <option>Select...</option>
                                    {% for place in places %}
                                        <optgroup label="{{ place.details }}">
                                            <option value="{{ place.id }}">{{ place.details }}</option>
                                            {% if locations[place.id] %}
                                                {% for location in locations[place.id] %}
                                                    <option value="{{ location.id }}" {% if location.id == reportIssue.location.id %} selected="selected"{% endif %}>{{ location.details }}</option>
                                                {% endfor %}
                                            {% endif %}
                                        </optgroup>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="row form-group" id="select_furniture">
                                <label for="furniture">Select a Furniture</label>
                                <select id="furniture" class="form-control input-sm select2">
                                </select>
                            </div>
                            <div class="row form-group">
                                {{ form_label(edit_form.details,'Description',{'attr':{
                                    'class' :' control-label',
                                }}) }}
                                {{ form_widget(edit_form.details, {'attr':{
                                    'class' :'input-sm pull-right form-control'
                                }}) }}
                                {{ form_errors(edit_form.details) }}
                            </div>
                            <div class="row form-group">
                                {{ form_label(edit_form.image,'Image',{'attr':{
                                    'class' :' control-label',
                                }}) }}
                                {{ form_widget(edit_form.image, {'attr':{
                                    'class' :'',
                                    'capture': "camera",
                                    'accept' :'image/*'
                                }}) }}
                                {{ form_errors(edit_form.image) }}
                            </div>
                            <div class="row form-group">
                                {{ form_label(edit_form.priority,'Prioriteit',{'attr':{
                                    'class' :' control-label',
                                }}) }}
                                {{ form_widget(edit_form.priority, {'attr':{
                                    'class' :'input-sm form-control'
                                }}) }}
                                {{ form_errors(edit_form.priority) }}
                            </div>

                            <div class="row form-group">
                                {{ form_label(edit_form.reporter,'Reporter',{'attr':{
                                    'class' :' control-label',
                                }}) }}
                                {{ form_widget(edit_form.reporter, {'attr':{
                                    'class' :'input-sm pull-right form-control',
                                }}) }}
                                {{ form_errors(edit_form.reporter) }}
                            </div>
                            <br><br>
                            <div class="form-group">
                                <button type="submit" id="restaurantbundle_reportissue_submit" name="restaurantbundle_reportissue[submit]" class="btn btn-primary">Update</button>

                            </div>
                            <br><br>

                            <div class="row form-group " hidden="hidden" style="display: none">
                                {{ form_rest(edit_form) }}
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>

        function updateValue(id, current){
            $("#report_issue_furniture").val(id)
        }
        $('#location').change(function () {
            $.post("{{ path('reportissue_getfurnitures') }}", {'id':$(this).val()}, function(response){
                option = '<select id="furniture" class="form-control input-sm select2" onchange="updateValue($(this).val(), $(this))"><option>Select ...</option>';
                for (var item in response){
                    option += '<option value="'+item+'" >'+response[item]+'</option>'
                }
                option += '</select>'
                $("#select_furniture select").remove()
                $("#select_furniture").append(option)

            })
            $("#report_issue_location").val($(this).val())

        })

        $('#location').trigger('change')
        setTimeout(function(){
            $('#furniture').ready(function () {
                $('#furniture option[value='+ $("#report_issue_furniture").val() +']').attr('selected','selected');

            })

        }, 1000)

    </script>
{% endblock %}
